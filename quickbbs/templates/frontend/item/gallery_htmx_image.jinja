{% autoescape off %}
<div class="filetype-bg filetype-main-container">

    {% include 'components/breadcrumb.jinja' %}

    {% include 'components/title_display.jinja' %}

    <div class="filetype-content-container" width="98%">
        <div hx-boost="true">
                {% if any([filetype.is_html, filetype.is_text, filetype.is_markdown]) %}
                <div class="has-text-left filetype-bg item-text-frame" id="text_frame">
                    <p class="has-text-left" id="text_frame" defer>
                        {{html}}
                    </p>
                {% endif %}
                {% if any([filetype.is_image, filetype.is_dir, filetype.is_link, filetype.is_archive]) %}
                <div class="thumbnail filetype-bg" id="thumbnail_frame">
                    <div class="has-text-centered">
                        <figure class="image">
                            <a href="{{ download_uri }}" hx-boost="false" id="image_link">
                                {% if not is_animated %}
                                    <img id="display_image" class="responsive-image" src="{{thumbnail_uri}}"/>
                                {% else %}
                                    <img id="display_image" class="responsive-image" src="{{download_uri}}" hx-boost="false"/>
                                {% endif %}
                            </a>
                        </figure>
                    </div>
                {% elif filetype.is_pdf %}
                <div class="thumbnail filetype-bg" id="thumbnail_frame">
                    <div class="has-text-centered">
                        <figure class="image">
                            <a href="/resources/javascript/pdfjs/web/viewer.html?file={{ download_uri }}" hx-boost="false" id="image_link">
                                <img id="display_image" class="responsive-image" src="{{thumbnail_uri}}"/>
                            </a>
                        </figure>
                    </div>

                {% elif filetype.is_movie %}
                <div class="thumbnail filetype-bg" id="movie_frame" hx-boost="false">
                    <div class="has-text-centered">
                        <video class="responsive-video" controls poster="{{ thumbnail_uri }}" preload="metadata" hx-boost="false">
                            <source src="{{ download_uri }}" type="video/mp4" />
                          Your browser does not support the video tag.
                        </video>

                    </div>
                {% endif %}
                    <div class="columns is-multiline item-columns">
                        <div class="column is-one-half item-column-half">
                            <span class="is-size-7"><span class="has-text-weight-bold" id="last_mod_head">Last Modified: </span></span>
                            <span class="is-size-7">{{lastmod_ds}}</span>
                        </div>
                        <div class="column is-one-half item-column-half">
                            <span class="is-size-7"><span class="has-text-weight-bold" id="file_size_head">File Size: </span></span>
                            <span class="is-size-7">{{ filesize }}</span>
                        </div>
                        <div class="column is-11 is-narrow item-column-full" id="uuid_head">
                            <span class="is-size-7"> <div class="has-text-centered"><span class="has-text-weight-bold">UUID:</span><span id="uuid">{{uuid}}</span></div>
                        </div>
                </div> <!--- Thumbnail --->
            </div>
        </div>
        </div>
    </div>
</div>

<div data-page-title="{{ filename }}" style="display:none;"></div>

<style>
/*
 * IMPORTANT: These styles are duplicated in two locations:
 * 1. /Volumes/C-8TB/gallery/quickbbs/quickbbs/static/resources/css/quickbbs-optimized.css
 * 2. This template file (gallery_htmx_image.jinja)
 *
 * When updating these styles, ALWAYS update BOTH files to keep them in sync.
 * The inline version is needed for HTMX partial updates.
 */

/* Filetype Content Container - constrain to viewport */
.filetype-content-container {
    max-width: 98%;
    max-height: calc(100vh - 200px);
    height: calc(100vh - 200px);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

/* Ensure all container divs respect height constraints */
.filetype-content-container > div,
.thumbnail,
#thumbnail_frame,
#movie_frame {
    max-height: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

/* Override Bulma's figure styles to allow proper sizing */
.filetype-content-container figure.image {
    height: auto !important;
    max-height: calc(100vh - 250px);
    width: auto !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
}

.filetype-content-container figure.image a {
    display: flex;
    align-items: center;
    justify-content: center;
    max-height: 100%;
}

/* Responsive Image Sizing */
.responsive-image {
    max-width: 100%;
    max-height: calc(100vh - 250px) !important;
    width: auto !important;
    height: auto !important;
    object-fit: contain;
    display: block;
}

/* Responsive Video Sizing */
.responsive-video {
    max-width: 100%;
    max-height: calc(100vh - 250px) !important;
    width: auto !important;
    height: auto !important;
    object-fit: contain;
    display: block;
}
</style>
{% endautoescape %}