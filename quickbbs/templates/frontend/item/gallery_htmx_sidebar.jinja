<!-- Optimized Django Sidebar Template -->
<aside class="sidebar is-narrow" id="sidebar">
  <div class="sidebar-content">

    <!-- Navigation Up Button -->
    <div class="sidebar-section">
      <a class="button is-ghost is-fullwidth"
         href="{{ up_uri }}?page={{page_locale}}&sort={{sort}}"
         hx-get="{{ up_uri }}?page={{page_locale}}&sort={{sort}}"
         hx-swap="innerHTML show:window:top"
         hx-target="body"
         hx-push-url="true"
         title="Go Up">
        {{ icon("arrow-up fa-2x") }}
      </a>
    </div>

    <!-- Pagination Controls using Bulma Pagination -->
    <div class="sidebar-section">
      <nav class="pagination is-small is-centered" role="navigation" aria-label="pagination">
        <!-- First/Previous combined -->
        <a class="pagination-previous{% if not previous_sha %} is-disabled{% endif %}"
           href="/view_item/{{ previous_sha if previous_sha else first_sha }}?sort={{sort}}"
           hx-get="/view_item/{{ previous_sha if previous_sha else first_sha }}?sort={{sort}}"
           hx-target="body"
           hx-swap="outerHTML"
           hx-push-url="true"
           {% if not previous_sha %}disabled aria-disabled="true"{% endif %}
           title="Previous">
          {{ icon("angle-left") }}
        </a>

        <!-- Next/Last combined -->
        <a class="pagination-next{% if not next_sha %} is-disabled{% endif %}"
           href="/view_item/{{ next_sha if next_sha else last_sha }}?sort={{sort}}"
           hx-get="/view_item/{{ next_sha if next_sha else last_sha }}?sort={{sort}}"
           hx-target="body"
           hx-swap="outerHTML"
           hx-push-url="true"
           {% if not next_sha %}disabled aria-disabled="true"{% endif %}
           title="Next">
          {{ icon("angle-right") }}
        </a>

        <!-- Page list (First, Page Display, Last) -->
        <ul class="pagination-list">
          <li>
            <a href="/view_item/{{ first_sha }}?sort={{sort}}"
               hx-get="/view_item/{{ first_sha }}?sort={{sort}}"
               hx-target="body"
               hx-swap="outerHTML"
               hx-push-url="true"
               class="pagination-link{% if not previous_sha %} is-disabled{% endif %}"
               {% if not previous_sha %}aria-disabled="true"{% endif %}
               title="First Page">
              {{ icon("angle-double-left") }}
            </a>
          </li>

          <li class="pagination-page-selector">
            <div class="field">
              <label class="label is-small has-text-centered">Page</label>
              <div class="page-display">
                <span>{{ page }}</span>
              </div>
              <p class="help has-text-centered">of {{ pagecount }}</p>
            </div>
          </li>

          <li>
            <a href="/view_item/{{ last_sha }}?sort={{sort}}"
               hx-get="/view_item/{{ last_sha }}?sort={{sort}}"
               hx-target="body"
               hx-swap="outerHTML"
               hx-push-url="true"
               class="pagination-link{% if not next_sha %} is-disabled{% endif %}"
               {% if not next_sha %}aria-disabled="true"{% endif %}
               title="Last Page">
              {{ icon("angle-double-right") }}
            </a>
          </li>
        </ul>
      </nav>
    </div>

    <!-- Open in New Tab Button -->
    {% if next_sha %}
    <div class="sidebar-section">
      <a class="button is-ghost is-fullwidth"
         href="/view_item/{{ next_sha }}?sort={{sort}}&newwin=True"
         target="_blank"
         hx-boost="false"
         title="Open Next in New Tab">
        {{ icon('fas fa-external-link-alt fa-2x') }}
      </a>
    </div>
    {% endif %}

    <!-- Download Button -->
    <div class="sidebar-section">
      <a class="button is-ghost is-fullwidth"
         href="{{ download_uri }}"
         hx-boost="false"
         title="Download">
        {{ icon('arrow-down fa-2x') }}
      </a>
    </div>

    <!-- Sort Options -->
    <div class="sidebar-section">
      <div class="field">
        <label class="label is-small has-text-centered">Sort</label>
        <form action="" method="GET" class="sort-form">
          <input type="hidden" name="page" value="{{current_page}}">
          <div class="select is-small is-fullwidth">
            <select name="sort" onchange="this.form.submit()">
              <option value="0" {% if sort == 0 %}selected{% endif %}>A..Z</option>
              <option value="1" {% if sort == 1 %}selected{% endif %}>Last Modified</option>
              <option value="2" {% if sort == 2 %}selected{% endif %}>Created</option>
            </select>
          </div>
        </form>
      </div>
    </div>

  </div>
</aside>

<style>
/* Custom CSS for the sidebar */
.sidebar {
  position: fixed;
  left: 0;
  top: 98px;
  height: 100vh;
  width: 7.5%;
  background: hsl(0, 0%, 98%);
  border-right: 1px solid hsl(0, 0%, 86%);
  z-index: 30;
  overflow-y: auto;
}

/* Image container positioning to avoid sidebar overlap */
.filetype-main-container {
  margin-left: 7.5%;
  margin-right: 1rem;
}

.sidebar-content {
  padding: 0.5rem 0.25rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.sidebar-section {
  padding: 0.25rem 0;
}

.sidebar-section:not(:last-child) {
  border-bottom: 1px solid hsl(0, 0%, 86%);
  padding-bottom: 0.5rem;
  margin-bottom: 0.5rem;
}

/* Bulma pagination customization for vertical layout */
.sidebar-section .pagination {
  flex-wrap: wrap;
  justify-content: center;
}

.sidebar-section .pagination-previous,
.sidebar-section .pagination-next {
  order: 1;
  flex-basis: calc(50% - 0.25rem);
  margin: 0.25rem;
  min-height: 3.5rem;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sidebar-section .pagination-list {
  order: 2;
  flex-basis: 100%;
  justify-content: center;
  margin-top: 0.5rem;
  gap: 0.5rem;
}

.sidebar-section .pagination-link {
  min-height: 3rem;
  min-width: 3rem;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sidebar-section .pagination-link.is-current {
  font-size: 1rem;
}

.sidebar-section .pagination-page-selector {
  display: flex;
  align-items: center;
  justify-content: center;
}

.sidebar-section .pagination-page-selector .field {
  margin-bottom: 0;
}

.sidebar-section .pagination-page-selector .label {
  font-size: 0.65rem;
  margin-bottom: 0.25rem;
}

.sidebar-section .pagination-page-selector .page-display {
  text-align: center;
  font-weight: 600;
  font-size: 1rem;
  padding: 0.25rem 0;
}

.sidebar-section .pagination-page-selector .help {
  font-size: 0.65rem;
  margin-top: 0.25rem;
}

.sidebar-section .pagination-link.is-disabled,
.sidebar-section .pagination-previous.is-disabled,
.sidebar-section .pagination-next.is-disabled {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}

.button.is-ghost {
  border: 1px solid transparent;
  padding: 0.75rem;
  height: auto;
  min-height: 3.5rem;
}

.button.is-ghost:hover {
  background-color: hsl(0, 0%, 96%);
  border-color: hsl(0, 0%, 86%);
}

.field {
  margin-bottom: 0.5rem;
}

.label {
  font-size: 0.75rem;
  margin-bottom: 0.25rem;
  text-align: center;
}

.help {
  font-size: 0.65rem;
  text-align: center;
  margin-top: 0.25rem;
}

.select.is-small select {
  font-size: 0.75rem;
  height: 2rem;
}

/* Mobile responsiveness */
@media screen and (max-width: 768px) {
  .sidebar {
    width: 60px;
  }

  .filetype-main-container {
    margin-left: 60px;
    margin-right: 0.5rem;
  }

  .sidebar-content {
    padding: 0.25rem 0.125rem;
  }

  .label,
  .help {
    display: none;
  }

  .field {
    margin-bottom: 0.25rem;
  }

  .button.is-ghost {
    padding: 0.5rem;
    min-height: 3rem;
  }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .sidebar {
    background: hsl(0, 0%, 14%);
    border-right-color: hsl(0, 0%, 29%);
  }

  .sidebar-section:not(:last-child) {
    border-bottom-color: hsl(0, 0%, 29%);
  }
}
</style>
