{% from 'macros/metadata.jinja' import show_item_metadata %}
{% from 'macros/htmx.jinja' import show_htmx_attrs, show_nav_link %}
{% from 'macros/gallery.jinja' import show_gallery_item_card %}

<style>
/* Gallery Container */
.gallery-container {
    max-width: 93%;
    margin-left: 7%;
    margin-right: 0px;
    margin-top: 0px;
    padding: 0.25rem;
}

/* Navigation customizations for Bulma level */
.level {
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    align-items: center;
}

.level-left,
.level-right {
    flex-shrink: 0;
}

.level-item.is-breadcrumb {
    flex: 1 1 auto;
    min-width: 0;
    justify-content: center;
    overflow: hidden;
}

.level-item.is-breadcrumb .breadcrumb {
    max-width: 100%;
}

.level-item.is-breadcrumb .breadcrumb ul {
    flex-wrap: wrap;
    justify-content: center;
}

.level-item.is-breadcrumb .breadcrumb li {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.nav-link {
    font-size: 0.875rem;
    color: #3273dc;
    text-decoration: none;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 150px;
}

/* Gallery Grid */
.gallery-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 1px;
    border: 1px solid #000;
    padding: 1px;
}

.gallery-item {
    flex: 1 1 calc(33.333% - 2px);
    min-width: 200px;
    border: 0px;
    padding: 0.5rem;
    display: flex;
    flex-direction: column;
    position: relative;
}

/* Item Header */
.item-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 0.0rem;
    margin-top: 0.0rem;
}

.item-index {
    font-weight: bold;
    margin-right: 0.5rem;
    min-width: 20px;
}

.item-title {
    flex: 1;
    font-size: 1.0rem;
    line-height: 1.0;
    word-wrap: break-word;
    text-align: center;
    width: 100%;
    margin-bottom: 0.0 rem;
}

.item-title a {
    color: black !important;
    text-decoration: none;
}

/* Additional CSS optimizations */
.gallery-item-link {
    color: black !important;
    text-decoration: none;
}

.thumbnail-image {
    object-fit: contain;
    max-width: {{small_width}}px;
    max-height: {{small_height}}px;
    height: auto;
}

/* Use CSS containment for performance */
.gallery-item {
    contain: layout style paint;
}

.film-indicator {
    margin-left: 0.25rem;
}

/* Thumbnail Container */
.thumbnail-container {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0.25rem 0;
    position: relative;
}

.thumbnail {
    max-width: {{small_width}}px;
    max-height: {{small_height}}px;
    height: auto;
    border-radius: 4px;
}

.external-link {
    position: absolute;
    top: -15px;
    right: -5px;
    background: transparent;
    border-radius: 50%;
    padding: 6px;
    font-size: 1.25rem;
    color: #3273dc;
    text-decoration: none;
}

/* Metadata */
.item-metadata {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.5rem;
    font-size: 1.00rem;
    margin-top: auto;
    width:100%;
}

.item-metadata .icon-text {
    color: #000;
}

.item-metadata .icon {
    width: 20px;
}

/* Responsive Design - Using Bulma breakpoints */
/* Bulma tablet breakpoint: 769px */
@media screen and (max-width: 768px) {
    .gallery-item {
        flex: 1 1 calc(50% - 2px);
        min-width: 150px;
    }

    /* Level component stacks on mobile by default */
    .level {
        display: flex;
        flex-direction: column;
    }
}

/* Bulma mobile breakpoint: 480px */
@media screen and (max-width: 480px) {
    .gallery-item {
        flex: 1 1 100%;
    }

    .gallery-container {
        max-width: 100%;
        margin-left: 0;
        padding: 0.5rem;
    }
}
</style>

<div class="gallery-container">
    <!-- Navigation Header using Bulma Level -->
    {% with
        sort_param = '?sort=' ~ sort,
        swap_mode = 'innerHTML show:window:top transition:true'
    %}
    <nav class="level">
        <div class="level-left">
            {% if prev_uri not in ["", None] %}
                <div class="level-item">
                    {% call show_nav_link(prev_uri.url ~ sort_param, '', css_class='nav-link', swap=swap_mode) %}
                        <i class="fas fa-angle-left"></i>
                        {{ prev_uri.name[:25] }}
                    {% endcall %}
                </div>
            {% endif %}
        </div>

        <div class="level-item is-breadcrumb">
            {% include 'components/breadcrumb.jinja' %}
        </div>

        <div class="level-right">
            {% if next_uri not in ["", None] %}
                <div class="level-item">
                    {% call show_nav_link(next_uri.url ~ sort_param, '', css_class='nav-link', swap=swap_mode) %}
                        {{ next_uri.name[:25] }}
                        <i class="fas fa-angle-right"></i>
                    {% endcall %}
                </div>
            {% endif %}
        </div>
    </nav>
    {% endwith %}

    <!-- Gallery Grid -->
    <div class="gallery-grid">
        {%- for item in items_to_display -%}
            {{ show_gallery_item_card(item, loop.index, sort, fromtimestamp) }}
        {% endfor %}
    </div>
</div>