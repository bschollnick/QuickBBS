{#
  HTMX Macros for QuickBBS

  This file provides reusable macros for generating HTMX-enabled links and elements
  with consistent attributes across the application.

  Usage:
      {% from 'macros/htmx.jinja' import show_nav_link, show_nav_button, show_htmx_attrs %}
#}

{#
  HTMX Navigation Link Macro

  Creates a link with standard HTMX attributes for SPA-like navigation.
  Supports both simple text and custom HTML content via caller() functionality.

  Args:
      url (str): The URL to navigate to
      text (str): Link text to display (used when caller() is not provided)
      css_class (str): Additional CSS classes (optional)
      extra_attrs (str): Additional HTML attributes (optional)
      swap (str): HTMX swap strategy (default: "outerHTML transition:true")

  Usage:
      Simple text link:
          {{ show_nav_link("/gallery/1", "View Gallery") }}
          {{ show_nav_link(item.url, item.name, css_class="button is-primary") }}

      Custom content with caller():
          {% call show_nav_link(prev_uri.url, css_class='nav-link') %}
              <i class="fas fa-angle-left"></i>
              {{ prev_uri.name[:25] }}
          {% endcall %}

  Output:
      <a href="/gallery/1" hx-get="/gallery/1" ...>View Gallery</a>
#}
{% macro show_nav_link(url, text, css_class='', extra_attrs='', swap='outerHTML transition:true') %}
<a href="{{ url }}"
   hx-get="{{ url }}"
   hx-push-url="true"
   hx-target="body"
   hx-swap="{{ swap }}"
   hx-headers='{"Cache-Control": "max-age=300"}'
   {% if css_class %}class="{{ css_class }}"{% endif %}
   {{ extra_attrs|safe }}>
  {% if caller %}{{ caller()|safe }}{% else %}{{ text }}{% endif %}
</a>
{% endmacro %}

{#
  HTMX Navigation Button Macro

  Creates a button/link with standard HTMX attributes for SPA-like navigation.
  Designed for icon-based navigation buttons (up, download, etc.)

  Args:
      url (str): The URL to navigate to
      icon_name (str): FontAwesome icon name (e.g., "arrow-up fa-2x")
      title (str): Tooltip text (optional)
      css_class (str): CSS classes (default: "button is-ghost")
      extra_attrs (str): Additional HTML attributes (optional)

  Usage:
      {{ show_nav_button(up_uri, "arrow-up fa-2x", title="Go Up") }}

  Output:
      <a href="..." class="button is-ghost" ...><i class="fas fa-arrow-up fa-2x"></i></a>
#}
{% macro show_nav_button(url, icon_name, title='', css_class='button is-ghost', extra_attrs='') %}
<a href="{{ url }}"
   class="{{ css_class }}"
   hx-get="{{ url }}"
   hx-push-url="true"
   hx-target="body"
   hx-swap="innerHTML show:window:top"
   {% if title %}title="{{ title }}"{% endif %}
   {{ extra_attrs|safe }}>
  {{ icon(icon_name) }}
</a>
{% endmacro %}

{#
  HTMX Attributes String Generator

  Returns HTMX attributes as a string for inline use in templates.
  Useful when you need to add HTMX behavior to existing HTML elements.

  Args:
      target (str): HTMX target selector (default: "body")
      swap (str): HTMX swap strategy (default: "outerHTML transition:true")
      cache (bool): Include cache-control headers (default: True)

  Usage:
      <a href="{{ url }}" {{ show_htmx_attrs()|safe }}>Link</a>
      <a href="{{ url }}" {{ show_htmx_attrs(swap='innerHTML')|safe }}>Link</a>

  Output:
      hx-push-url="true" hx-target="body" hx-swap="outerHTML transition:true" hx-headers='{"Cache-Control": "max-age=300"}'
#}
{% macro show_htmx_attrs(target='body', swap='outerHTML transition:true', cache=True) %}
hx-push-url="true" hx-target="{{ target }}" hx-swap="{{ swap }}"{% if cache %} hx-headers='{"Cache-Control": "max-age=300"}'{% endif %}
{% endmacro %}

{#
  HTMX Page Title Update

  Renders a hidden div for HTMX page title updates.
  The div is picked up by JavaScript to update document.title.

  Args:
      title (str): The page title to set
      only_htmx (bool): Only render for HTMX requests (default: False)
      request (object): Django request object (required when only_htmx=True)

  Usage:
      show_page_title_meta("My Page Title", request=request)
      show_page_title_meta(filename, only_htmx=True, request=request)

  Note:
      The request parameter must be explicitly passed as macros don't have
      automatic access to template context variables.
#}
{% macro show_page_title_meta(title, only_htmx=False, request=None) %}
{% if not only_htmx or (request and request.htmx) %}
<title>{{ title }}</title>
{% endif %}
{% endmacro %}

{#
  Partial Template Wrapper

  Wraps partial template content with optional HTMX features.
  Uses Jinja2's caller() functionality for flexible content inclusion.

  Args:
      show_title_update (bool): Include HTMX page title update (default: False)
      show_hx_boost (bool): Wrap in hx-boost container (default: False)
      title (str): Page title for HTMX updates (if show_title_update=True)
      request (object): Django request object (required when show_title_update=True)

  Usage:
      Gallery listing (with hx-boost):
          {% call show_partial_wrapper(show_hx_boost=True) %}
              {% include 'components/navbar.jinja' %}
              {% include 'frontend/gallery/gallery_listing_sidebar.jinja' %}
              {% include 'frontend/gallery/gallery_listing_images.jinja' %}
          {% endcall %}

      Item view (with title update):
          {% call show_partial_wrapper(show_title_update=True, title=filename, request=request) %}
              {% include 'components/navbar.jinja' %}
              {% include 'frontend/item/gallery_htmx_sidebar.jinja' %}
              {% include 'frontend/item/gallery_htmx_image.jinja' %}
          {% endcall %}

  Note:
      The request parameter must be explicitly passed as macros don't have
      automatic access to template context variables.
#}
{% macro show_partial_wrapper(show_title_update=False, show_hx_boost=False, title='', request=None) %}
{% if show_hx_boost %}<div hx-boost="true" class="partial-container">{% endif %}
{% if show_title_update and request and request.htmx %}
<title>{{ title }}</title>
{% endif %}
{% autoescape off %}
{{ caller() }}
{% endautoescape %}
{% if show_hx_boost %}</div>{% endif %}
{% endmacro %}
